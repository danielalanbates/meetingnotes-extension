<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test AI Features - BatesAI</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }

    h1 {
      text-align: center;
      color: #333;
    }

    .setup-section {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .status {
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-weight: 600;
    }

    .status.active {
      background: #d4edda;
      color: #155724;
      border: 2px solid #c3e6cb;
    }

    .status.inactive {
      background: #f8d7da;
      color: #721c24;
      border: 2px solid #f5c6cb;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #4A90E2;
      color: white;
    }

    .btn-primary:hover {
      background: #357ABD;
      transform: translateY(-2px);
    }

    .btn-success {
      background: #28A745;
      color: white;
    }

    .feature-section {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .feature-section h2 {
      margin-top: 0;
      color: #4A90E2;
    }

    textarea {
      width: 100%;
      min-height: 120px;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
      font-family: monospace;
      margin-bottom: 10px;
    }

    .result {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      border-left: 4px solid #4A90E2;
      margin-top: 10px;
      white-space: pre-wrap;
      font-family: monospace;
      font-size: 13px;
    }

    .loading {
      opacity: 0.6;
      pointer-events: none;
    }

    .spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 3px solid rgba(0,0,0,0.1);
      border-top-color: #4A90E2;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .sample-notes {
      font-size: 13px;
      color: #666;
      margin-bottom: 10px;
    }

    .api-key-input {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
      font-family: monospace;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <h1>ü§ñ BatesAI - Test AI Features</h1>

  <!-- Setup Section -->
  <div class="setup-section">
    <h2>Setup</h2>
    <div id="premiumStatus" class="status inactive">
      ‚ùå Premium not activated - Click "Activate Demo Mode" below
    </div>

    <button id="activateDemoBtn" class="btn btn-primary">Activate Demo Mode</button>
    <button id="clearStorageBtn" class="btn" style="background: #DC3545; color: white; margin-left: 10px;">Reset (Clear Storage)</button>

    <div style="margin-top: 20px;">
      <label for="apiKeyInput"><strong>OpenAI API Key (optional for real AI results):</strong></label>
      <input type="text" id="apiKeyInput" class="api-key-input" placeholder="sk-...">
      <button id="saveApiKeyBtn" class="btn btn-success">Save API Key</button>
      <p style="font-size: 12px; color: #666;">
        Get your API key from <a href="https://platform.openai.com/api-keys" target="_blank">platform.openai.com/api-keys</a>
      </p>
    </div>
  </div>

  <!-- Feature 1: AI Summarize -->
  <div class="feature-section">
    <h2>1. AI Meeting Summary</h2>
    <p class="sample-notes">Transform lengthy meeting notes into concise bullet points</p>
    <textarea id="summaryInput" placeholder="Enter meeting notes...">Team meeting about Q4 planning. Sarah presented the marketing budget proposal for $50,000 to run ads across Google and Facebook. John suggested we could reallocate funds from the operations budget since we're under budget there. After discussion, everyone agreed this was the best approach. Finance team needs to approve by Friday. Mike will prepare the reallocation document. Launch date tentatively set for March 15th.</textarea>
    <button id="summarizeBtn" class="btn btn-primary">Generate Summary</button>
    <div id="summaryResult" class="result" style="display: none;"></div>
  </div>

  <!-- Feature 2: Action Items -->
  <div class="feature-section">
    <h2>2. AI Action Items Extraction</h2>
    <p class="sample-notes">Automatically identify tasks, owners, and deadlines</p>
    <textarea id="actionItemsInput" placeholder="Enter meeting notes...">Sprint planning meeting. John needs to complete the user authentication feature by Wednesday. Sarah will review the API documentation and provide feedback to the team. We need to schedule a follow-up meeting for next Tuesday at 2pm to review progress. Mike should prepare demo slides for the stakeholder presentation.</textarea>
    <button id="actionItemsBtn" class="btn btn-primary">Extract Action Items</button>
    <div id="actionItemsResult" class="result" style="display: none;"></div>
  </div>

  <!-- Feature 3: Format Notes -->
  <div class="feature-section">
    <h2>3. AI Smart Formatting</h2>
    <p class="sample-notes">Convert messy notes into professional documents</p>
    <textarea id="formatInput" placeholder="Enter messy notes...">client call with acme corp, discussed new contract, they want 20 percent discount we agreed to 10, delivery timeline 6 weeks, next meeting march 1st, need to send updated contract</textarea>
    <button id="formatBtn" class="btn btn-primary">Format Notes</button>
    <div id="formatResult" class="result" style="display: none;"></div>
  </div>

  <!-- Feature 4: Email Generator -->
  <div class="feature-section">
    <h2>4. AI Follow-up Email</h2>
    <p class="sample-notes">Create professional emails from meeting notes</p>
    <textarea id="emailInput" placeholder="Enter meeting notes...">Client meeting with Acme Corp. Discussed new contract terms. They wanted 20% discount, we agreed to 10%. Delivery timeline: 6 weeks. Next meeting scheduled for March 1st. Action: Send updated contract by end of week.</textarea>
    <button id="emailBtn" class="btn btn-primary">Generate Email</button>
    <div id="emailResult" class="result" style="display: none;"></div>
  </div>

  <script src="ai-service.js"></script>
  <script>
    let aiService;
    let isPremium = false;
    let apiKey = null;

    // Initialize
    document.addEventListener('DOMContentLoaded', async () => {
      await checkPremiumStatus();
      setupEventListeners();
      aiService = new AIService();
    });

    // Check premium status
    async function checkPremiumStatus() {
      const result = await chrome.storage.local.get(['isPremium', 'openai_api_key', 'premiumMethod']);
      isPremium = result.isPremium === true;
      apiKey = result.openai_api_key || null;

      const statusDiv = document.getElementById('premiumStatus');
      if (isPremium) {
        statusDiv.className = 'status active';
        statusDiv.textContent = `‚úÖ Premium Active (Method: ${result.premiumMethod || 'unknown'})`;
        document.getElementById('activateDemoBtn').textContent = '‚úì Demo Active';
        document.getElementById('activateDemoBtn').disabled = true;
      }

      if (apiKey) {
        document.getElementById('apiKeyInput').value = apiKey;
      }
    }

    // Setup event listeners
    function setupEventListeners() {
      document.getElementById('activateDemoBtn').addEventListener('click', activateDemoMode);
      document.getElementById('clearStorageBtn').addEventListener('click', clearStorage);
      document.getElementById('saveApiKeyBtn').addEventListener('click', saveApiKey);

      document.getElementById('summarizeBtn').addEventListener('click', () => testFeature('summary'));
      document.getElementById('actionItemsBtn').addEventListener('click', () => testFeature('actionItems'));
      document.getElementById('formatBtn').addEventListener('click', () => testFeature('format'));
      document.getElementById('emailBtn').addEventListener('click', () => testFeature('email'));
    }

    // Activate demo mode
    async function activateDemoMode() {
      await chrome.storage.local.set({
        isPremium: true,
        premiumMethod: 'demo',
        premiumActivatedAt: new Date().toISOString(),
        premiumFeatures: {
          aiSummarize: true,
          aiActionItems: true,
          aiFormat: true,
          aiEmail: true,
          realTimeTranscription: true,
          customTemplates: true,
          unlimitedAI: true
        }
      });

      alert('‚úÖ Demo Mode Activated!\n\nAll premium features are now unlocked.\n\nTo test AI features with real results, enter your OpenAI API key below.');
      await checkPremiumStatus();
    }

    // Save API key
    async function saveApiKey() {
      const key = document.getElementById('apiKeyInput').value.trim();
      if (!key) {
        alert('Please enter an API key');
        return;
      }

      if (!key.startsWith('sk-')) {
        alert('Invalid API key format. OpenAI keys start with "sk-"');
        return;
      }

      await chrome.storage.local.set({ openai_api_key: key });
      apiKey = key;
      alert('‚úÖ API Key Saved!\n\nYou can now test AI features with real results.');
    }

    // Clear storage
    async function clearStorage() {
      if (confirm('Reset everything? This will clear premium status and API key.')) {
        await chrome.storage.local.remove(['isPremium', 'openai_api_key', 'premiumMethod', 'premiumActivatedAt', 'premiumFeatures']);
        alert('Storage cleared. Page will reload.');
        location.reload();
      }
    }

    // Test AI feature
    async function testFeature(type) {
      if (!isPremium) {
        alert('‚ùå Premium not activated\n\nClick "Activate Demo Mode" first!');
        return;
      }

      if (!apiKey) {
        alert('‚ö†Ô∏è No API Key\n\nFeatures are unlocked, but you need an OpenAI API key to get real AI results.\n\nEnter your key below and click "Save API Key".');
        return;
      }

      let inputId, resultId, btnId, method;

      switch(type) {
        case 'summary':
          inputId = 'summaryInput';
          resultId = 'summaryResult';
          btnId = 'summarizeBtn';
          method = 'summarizeNotes';
          break;
        case 'actionItems':
          inputId = 'actionItemsInput';
          resultId = 'actionItemsResult';
          btnId = 'actionItemsBtn';
          method = 'extractActionItems';
          break;
        case 'format':
          inputId = 'formatInput';
          resultId = 'formatResult';
          btnId = 'formatBtn';
          method = 'formatNotes';
          break;
        case 'email':
          inputId = 'emailInput';
          resultId = 'emailResult';
          btnId = 'emailBtn';
          method = 'generateFollowUpEmail';
          break;
      }

      const notes = document.getElementById(inputId).value.trim();
      const resultDiv = document.getElementById(resultId);
      const btn = document.getElementById(btnId);

      if (!notes) {
        alert('Please enter some notes first');
        return;
      }

      try {
        // Show loading
        btn.innerHTML = '<span class="spinner"></span> Processing...';
        btn.disabled = true;
        resultDiv.style.display = 'none';

        // Initialize AI service with API key
        await aiService.initialize();

        // Call AI method
        const result = await aiService[method](notes);

        // Show result
        resultDiv.textContent = result;
        resultDiv.style.display = 'block';

      } catch (error) {
        alert('‚ùå Error: ' + error.message + '\n\nCheck:\n1. API key is valid\n2. You have OpenAI credits\n3. Internet connection\n\nConsole has more details.');
        console.error('AI Feature Error:', error);
      } finally {
        // Reset button
        btn.innerHTML = btn.textContent.includes('Summary') ? 'Generate Summary' :
                        btn.textContent.includes('Action') ? 'Extract Action Items' :
                        btn.textContent.includes('Format') ? 'Format Notes' :
                        'Generate Email';
        btn.disabled = false;
      }
    }
  </script>
</body>
</html>
